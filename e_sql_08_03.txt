
テキスト：達人に学ぶSQL徹底指南書 ～初級者で終わりたくないあなたへ～
日付：月日
作成者：玉利

問題番号：演習問題8-③素数を求める
内容：
最後に、ちょっと趣向を変えて数学パズルを一つ。
「素数」と言えば、私たちの誰もが学校で習う自然数の一種です。その定義は、

1とその数自身以外に正の約数を持たない(つまり1とその数以外のどんな自然数によっても割り切れない)、1より大きな自然数

でした。定義はごく簡単でありながら、面白い性質が多くあるため、昔から多くの人々を魅了してきた数です。ではこの素数を、SQLを使って求めてみましょう。素数は無限にあるので、100以下のものに限定します。準備として、1～100の数を持つNumbersテーブルを用意しておきます。(このテーブルの簡単な作り方は、次章を参照)。

Numbers
 num
-----
   1
   2
   3
 ・
 ・
 ・
  98
  99
 100
 
 100以下の素数を小さい順に並べると、
   2,3,5,7,11,13,17・・・・・83,89,97
 となります。これを求めてください。
 
 
---回答---
実行文

SELECT *                                      -- 素数を取り出したいので数字を取り出す
  FROM numbers number1                        -- 1～100までの素数をとりたいのでその数字を持っているnumbersテーブルを指定する
 WHERE                                        -- 素数を取り出すための条件を追加する
       number1.num >1                         -- 1は素数に入らないので1より大きい数字を取り出す
   AND                                        -- 条件が足りないので追加する
       NOT EXISTS                             -- 下記内容に当てはまらない数字を取り出す
       (SELECT *                              -- 素数じゃない数字を取り出す
          FROM numbers number2                -- 数字を持っているテーブルを指定
         WHERE                                -- 素数ではない数字を取り出すための条件を追加する
              number2.num <> number1.num      -- 同じ数字では必ず割り切れてしまうので除外する
           AND                                -- 条件が足りないので条件の追加をする
              number2.num <> 1                -- 1では必ず割り切れてしまうので除外する
           AND                                -- 条件が足りないので条件の追加をする
             number1.num % number2.num = 0)   -- ほかの数字で割り切れるものは素数ではないので条件に追加する
ORDER BY                                      -- このままだと順番がバラバラなので並び替えをする
       number1.num ASC;                       -- テキスト通りに昇順になるように並び替える
       
実行結果

 num
-----
   2
   3
   5
   7
  11
  13
  17
  19
  23
  29
  31
  37
  41
  43
  47
  53
  59
  61
  67
  71
  73
  79
  83
  89
  97
