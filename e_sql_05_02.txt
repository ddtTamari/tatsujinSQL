
テキスト：達人に学ぶSQL徹底指南書 ～初級者で終わりたくないあなたへ～
日付：3月9日
作成者：玉利

問題番号：演習問題5-②子供の数にご用心
内容：「外部結合で行列変換 その２(列→行):繰り返し項目を1列にまとめる」(P.85)では、社員ごとの子供の一覧を求めました。こういうリストが得られれば、
一人の社員が何人の子供を扶養しているか、という情報も、社員単位で集約することで簡単に求められます。
では、本文のクエリを修正して、これを求めてください。求める結果は次のようになります。

多分、基本的に悩むことはないと思いますが、微妙に注意が必要なポイントがあるので、自分が書いたコードの結果と上の答えをよーく見比べてみてください。

---回答---
実行文

SELECT                                                     -- 社員とその子供の数が欲しいので命令文を作成する
   employee,                                               -- 社員名を取り出す
   COUNT(CHILDREN.child) AS child_cnt                      -- 子供の数をchild_cntとして数えて取り出す
from                                                       -- 社員名と子供のリストを持っているテーブルを指定する
   personnel                                               -- 社員名を持っているテーブルを指定する
LEFT OUTER JOIN                                            -- 各社員の名前は子供がいなくても残しておきたいのでLEFT JOINを使用
   CHILDREN                                                -- 子供の名前の一覧を持ているCHILDビューをもう一つのテーブルとして召喚
ON                                                         -- 結合するためのキーを指定する
   CHILDREN.Child IN (child_1,child_2,child_3)             -- 社員テーブルにいる子供たちの名前がCHILDのリストにあるやつによって結合する
GROUP BY                                                   -- 各社員ごとのこどもの人数を知りたいのでグルーピングを行う
   employee                                                -- 社員を軸に値をまとめる
;                                                          -- 命令文を終了させる
  
実行結果

+----------+-----------+
| employee | child_cnt |
+----------+-----------+
| 吉田     |         0 |
| 工藤     |         2 |
| 赤井     |         3 |
| 鈴木     |         1 |
+----------+-----------+

